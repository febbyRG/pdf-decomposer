<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Decomposer Browser Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            margin: 10px;
            border: 1px solid #ddd;
        }
        input[type="file"] { margin: 10px 0; }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>üîß PDF Decomposer Browser Test</h1>
    <p>Test the zero-dependency PDF image extraction in browser environment.</p>

    <div>
        <input type="file" id="pdfFile" accept=".pdf" />
        <button id="processBtn" onclick="processPDF()">Extract Images</button>
    </div>

    <div id="results"></div>
    <div id="images"></div>

    <script type="module">
        // Import the PDF decomposer (assuming it's built for browser)
        // Note: This would typically import from a bundled version

        window.processPDF = async function() {
            const fileInput = document.getElementById('pdfFile');
            const resultsDiv = document.getElementById('results');
            const imagesDiv = document.getElementById('images');
            const processBtn = document.getElementById('processBtn');

            if (!fileInput.files[0]) {
                resultsDiv.innerHTML = '<div class="result error">Please select a PDF file</div>';
                return;
            }

            processBtn.disabled = true;
            resultsDiv.innerHTML = '<div class="result">üîÑ Processing PDF...</div>';
            imagesDiv.innerHTML = '';

            try {
                const file = fileInput.files[0];
                const arrayBuffer = await file.arrayBuffer();
                const uint8Array = new Uint8Array(arrayBuffer);

                // Simulate PDF decomposer API call
                // In real usage: import { decomposePdf } from '@magloft/pdf-decomposer'

                const mockResult = [
                    {
                        pageNumber: 1,
                        images: [
                            {
                                id: 'test_img_1',
                                width: 800,
                                height: 600,
                                format: 'PNG',
                                data: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg=='
                            }
                        ]
                    }
                ];

                // Process results
                let totalImages = 0;
                const resultHTML = mockResult.map(page => {
                    totalImages += page.images.length;
                    return `
                        <div class="result success">
                            üìÑ Page ${page.pageNumber}: ${page.images.length} images extracted
                        </div>
                    `;
                }).join('');

                resultsDiv.innerHTML = `
                    <div class="result success">
                        ‚úÖ Successfully extracted ${totalImages} images from ${mockResult.length} pages
                    </div>
                    ${resultHTML}
                `;

                // Display image previews
                const imageHTML = mockResult.flatMap(page =>
                    page.images.map(img => `
                        <div>
                            <h4>Image: ${img.id} (${img.width}√ó${img.height})</h4>
                            <img src="${img.data}" class="image-preview" alt="${img.id}" />
                            <p>Format: ${img.format}, Size: ${Math.round(img.data.length * 0.75 / 1024)}KB</p>
                        </div>
                    `)
                ).join('');

                imagesDiv.innerHTML = imageHTML;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="result error">‚ùå Error: ${error.message}</div>`;
            } finally {
                processBtn.disabled = false;
            }
        }
    </script>
</body>
</html>
